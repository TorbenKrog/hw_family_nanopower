% NanoPower P31U-7.0 Change Note
% GomSpace ApS
% November 2012

Design Upgrade Note NP31U-7.0
=============================

The NanoPower P31U hardware design has undergone an iteration taking it from revision 6.1.1 to revision 7.0. This upgrade is motivated by needs and wishes regarding both functionality, performance, handling, integration, producibility and aesthetics. The motivational factors are listed in the categories below. Besides all these factors, the design is migrated from Eagle PCB to Altium DXP making future upgrades far less painful and much more reliable.


Functionality
-------------

It has frequently been inquired as to whether the P31U can be configured with an arbitrary assignment of the two regulated output busses to any of the six latch-up protected outputs. This is now accommodated through a connection matrix. This matrix is made up of current sense resistors giving the added benefit of current measurements on each output channel which is a desire from the R&D dept. at GomSpace.

Having the ability to power cycle the entire P31U including internal supplies and all external channels is a wish from e.g. FunCube. This is now accommodated by tripping the kill-switch circuit from the uC.

The temperature sensor previously located at boost converter 2 is not moved to the measure the temprature of the buck converter's ground return plane. Experience has shown that there is only little temperature gradient between the three boost converters making three measurements somewhat redundant. 


Performance
-----------

The Maximum Power Point Tracking algorithm has been lacking accuracy and performance at high tumbling rates due to triple PV input current estimation using just the one ouput current measurement of the battery charge converter. This is solved by adding current measurements to all PV inputs enabling accurate and fast calculation of input power.

Boost converters in the battery charger used high inductances resulting in high DC loss. This is optimised by lowering inductance and hence resistance.

The buck converters have also got smaller inductances in order to optimise effeciency by minimising DC loss.

A more robust latch-up detection scheme is implemented using a dedicated interrupt channel on the uC for each output. This eliminates a large and bulky and often unreliable transistor-based detector circuit.


Handling
--------

Some tracks carrying raw battery voltage were very close to mounting holes in one corner causing a number of product failures due to short circuits when users were less than extremely careful with washers during integration. Battery voltage tracks are now kept at a safe distance from grounded areas.

The arm jumper at the positive battery terminal was located in a hard to reach spot on the PCB making it dangerous to operate the jumper when the P31U is integrated in a stack. The jumper is now moved to the edge of the board in an area containing no obstacles. This is obtained by rotating the battery pack 180 degrees such that + and - now face away from the stach connector.


Integration
-----------

All connections to and from the board are now through connectors instead of the through-hole solder pads used by PV inputs, charge input and kill-switch operation. This makes it much more convenient to integrated the P31U in a satellite. For the critical PV inputs redundant wiring is used - four wires per solar panel instead of two.

Two kill-switch connectors are placed at diagonal corners to enable short kill-switch wires.

Connectors for ISP and serial ports are placed at GomSpace standard location at one edge of the board to enable programming and debugging of a P31U even once integrated into a stack.


Producibility
-------------

All through-hole components are replaced by SMD to enable 99% automated assembly.

Outer layer ground planes and supply planes are reshaped to enable reflow soldering with automatic component alignment. This is done by using symmetric fills and by placing vias outside large solder areas such as thermal pads.

The inter-battery cell tab is ommitted by adding this connection on the PCB. This means that alle LiIon cells used in GomSpace products can now have the same tab configuration enabling mass batch production of tabbed batteries. This is possible because of the 180 degree rotation of the cells. It adds the benefit of safer soldering of the tabs to the board as three of the tabs are using slotted through holes similar to the BP4 system which minimises the risk of short circuits (a.k.a. arc welding) during soldering.

The use of connectors instead of through-hole pads for all external connections makes harness construction much easier as we can make cable assemblies of pre-crimped wires. This also eliminates the discussion of when to conformal coat: Before or after wire soldering.

One glueing work cycle has been eliminated as we nolonger use the suspended torus-style inductors.

Inspection (and the occasional replacement) of power deviced in the boost converters is greatly improved by not hiding components under the huge inductors covered in epoxy. All components are now freely visible and can be inspected and indeed replaced in case of a fault.

The kill-switch circuit can now be configured to "ISIS standard lock-less" without hacking the circuit.


Aesthetics
----------

A high degree of uniformity between similarly functioning sub-part of the board has been implemented resulting in an appearance which is "easy on the eye" and gives a quick overview of block functionality.

Tracks and planes on the outside out the board are minimised to yield a less confusing appearance.

The screws holding the batteries in place will be counter sunk in the bottom side of the board giving a more finished look. It also makes the screw head glueing look less messy.

Any sharp corners are rounded to blend into the style of the rest of the Nano product family.


Change Overview
---------------

- Current measurement on all three PV inputs
- Current measurement on all six lath-up protected outputs
- Optimised latch-up detection
- Power cycling ability added to kill-switch. Controlled by uC
- Connection matrix enabling any of the two buck converters to feed any of the six latch-up protected output.
- Added ISP PicoBlade connector to board edge
- Added standard GOSH-enabled serial port to board edge
- Batteries rotated 180 degrees to give better access to arm jumper
- Battery tabs connected to board using slotted holes for added robustness
- Boost converters use smaller SMD inductors for added effeciency and more robust assembly
- Boost converter power devised are nolong hidden under epoxy
- Buck converters use smaller inductors for higher effeciency
- PV inputs now use 4-pin PicoBlade connectors for easy integration and wire redundancy mating 1-1 with new P110 solar panels
- Kill-switch connections are now through two 2-pin PicoBlades placed at the cornes where ISIS kill-switches are located
- Flight preperation panel connection is now a 6-pin PicoBlade
- Microprocessor is upgraded to version with more ADC channels to fasilitate the added current measurements. The core is unchanged (Atmega 8)
- The software will nolonger be a custom monolitic blop which has been hard to maintain. The new processor has more memory and enables the use of standard GomSpace libraries including GOSH. This will help keep the P31U up to date as various software libraries mature.
- Battery screw heads are countersunk
- Board corners are rounded
- Old un-used IO connections to the CSK connectors are removed (only used on the the very first P30 built in 2007).
- Power point tracking will be able to control the input voltage in the entire range from 0V to a given max instead of the current system which can only increase the voltage relative to a fixed fall-back level (usually called the hardware power point)
- Overall quality appearance is improved through strict design and layout philosophy

